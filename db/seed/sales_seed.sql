--drop obiektów
BEGIN
EXECUTE IMMEDIATE 'DROP VIEW AI_V_SALES_ORDER_DAILY';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP VIEW AI_V_SALES_ORDER_LINES';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP VIEW V_SALES_ORDERS';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP VIEW V_SALES_CUSTOMERS';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/

BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_ORDER_LINES CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_ORDERS CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_PRODUCTS CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_CUSTOMERS CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_LU_PRODUCT_CATEGORY CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_LU_CURRENCY CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_LU_ORDER_STATUS CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_LU_COUNTRY CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE SALES_LU_SEGMENT CASCADE CONSTRAINTS PURGE';
EXCEPTION
WHEN OTHERS THEN
IF SQLCODE != -942 THEN RAISE; END IF;
END;
/

--create obiektów
CREATE TABLE SALES_LU_SEGMENT (
segment_code VARCHAR2(30) NOT NULL,
segment_desc VARCHAR2(200) NOT NULL,
CONSTRAINT pk_sales_lu_segment PRIMARY KEY (segment_code)
);

CREATE TABLE SALES_LU_COUNTRY (
country_code VARCHAR2(10) NOT NULL,
country_name VARCHAR2(100) NOT NULL,
CONSTRAINT pk_sales_lu_country PRIMARY KEY (country_code)
);

CREATE TABLE SALES_LU_ORDER_STATUS (
status_code VARCHAR2(20) NOT NULL,
status_desc VARCHAR2(100) NOT NULL,
CONSTRAINT pk_sales_lu_order_status PRIMARY KEY (status_code)
);

CREATE TABLE SALES_LU_CURRENCY (
currency_code VARCHAR2(3) NOT NULL,
currency_name VARCHAR2(50) NOT NULL,
CONSTRAINT pk_sales_lu_currency PRIMARY KEY (currency_code)
);

CREATE TABLE SALES_LU_PRODUCT_CATEGORY (
category_code VARCHAR2(30) NOT NULL,
category_desc VARCHAR2(200) NOT NULL,
CONSTRAINT pk_sales_lu_product_category PRIMARY KEY (category_code)
);

CREATE TABLE SALES_CUSTOMERS (
customer_id NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
customer_code VARCHAR2(30) NOT NULL,
customer_name VARCHAR2(200) NOT NULL,
segment_code VARCHAR2(30) NOT NULL,
city VARCHAR2(100),
country_code VARCHAR2(10) NOT NULL,
created_at DATE NOT NULL,
is_active CHAR(1) DEFAULT 'Y' NOT NULL,
CONSTRAINT pk_sales_customers PRIMARY KEY (customer_id),
CONSTRAINT uq_sales_customers_code UNIQUE (customer_code),
CONSTRAINT ck_sales_customers_active CHECK (is_active IN ('Y','N')),
CONSTRAINT fk_sales_customers_segment FOREIGN KEY (segment_code) REFERENCES SALES_LU_SEGMENT(segment_code),
CONSTRAINT fk_sales_customers_country FOREIGN KEY (country_code) REFERENCES SALES_LU_COUNTRY(country_code)
);

CREATE TABLE SALES_PRODUCTS (
product_id NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
sku VARCHAR2(40) NOT NULL,
product_name VARCHAR2(200) NOT NULL,
category_code VARCHAR2(30) NOT NULL,
is_active CHAR(1) DEFAULT 'Y' NOT NULL,
CONSTRAINT pk_sales_products PRIMARY KEY (product_id),
CONSTRAINT uq_sales_products_sku UNIQUE (sku),
CONSTRAINT ck_sales_products_active CHECK (is_active IN ('Y','N')),
CONSTRAINT fk_sales_products_category FOREIGN KEY (category_code) REFERENCES SALES_LU_PRODUCT_CATEGORY(category_code)
);

CREATE TABLE SALES_ORDERS (
order_id NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
order_no VARCHAR2(30) NOT NULL,
customer_id NUMBER NOT NULL,
created_at DATE NOT NULL,
closed_at DATE,
status_code VARCHAR2(20) NOT NULL,
currency_code VARCHAR2(3) NOT NULL,
notes VARCHAR2(4000),
CONSTRAINT pk_sales_orders PRIMARY KEY (order_id),
CONSTRAINT uq_sales_orders_order_no UNIQUE (order_no),
CONSTRAINT fk_sales_orders_customer FOREIGN KEY (customer_id) REFERENCES SALES_CUSTOMERS(customer_id),
CONSTRAINT fk_sales_orders_status FOREIGN KEY (status_code) REFERENCES SALES_LU_ORDER_STATUS(status_code),
CONSTRAINT fk_sales_orders_currency FOREIGN KEY (currency_code) REFERENCES SALES_LU_CURRENCY(currency_code)
);

CREATE TABLE SALES_ORDER_LINES (
line_id NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
order_id NUMBER NOT NULL,
product_id NUMBER NOT NULL,
qty NUMBER(12,2) NOT NULL,
unit_price_net NUMBER(12,2) NOT NULL,
tax_rate NUMBER(5,4) NOT NULL,
amount_net NUMBER(14,2) NOT NULL,
amount_gross NUMBER(14,2) NOT NULL,
CONSTRAINT pk_sales_order_lines PRIMARY KEY (line_id),
CONSTRAINT fk_sales_order_lines_order FOREIGN KEY (order_id) REFERENCES SALES_ORDERS(order_id),
CONSTRAINT fk_sales_order_lines_product FOREIGN KEY (product_id) REFERENCES SALES_PRODUCTS(product_id),
CONSTRAINT ck_sales_order_lines_qty CHECK (qty > 0),
CONSTRAINT ck_sales_order_lines_price CHECK (unit_price_net >= 0),
CONSTRAINT ck_sales_order_lines_tax CHECK (tax_rate BETWEEN 0 AND 1),
CONSTRAINT ck_sales_order_lines_amounts CHECK (amount_net >= 0 AND amount_gross >= 0)
);

CREATE INDEX idx_sales_orders_customer ON SALES_ORDERS(customer_id);
CREATE INDEX idx_sales_orders_status ON SALES_ORDERS(status_code);
CREATE INDEX idx_sales_orders_currency ON SALES_ORDERS(currency_code);
CREATE INDEX idx_sales_order_lines_order ON SALES_ORDER_LINES(order_id);
CREATE INDEX idx_sales_order_lines_product ON SALES_ORDER_LINES(product_id);

COMMENT ON TABLE SALES_LU_SEGMENT IS 'Słownik segmentów klientów sprzedażowych; ujednolica segmentację do raportowania i filtrów.';
COMMENT ON COLUMN SALES_LU_SEGMENT.segment_code IS 'Kod segmentu klienta; kod; np. SMB/RETAIL; PK; NL: segment, typ klienta.';
COMMENT ON COLUMN SALES_LU_SEGMENT.segment_desc IS 'Opis segmentu; tekst; np. Small Business; atrybut; NL: segment opis, kategoria klienta.';

COMMENT ON TABLE SALES_LU_COUNTRY IS 'Słownik krajów dla adresów klientów; używany do analiz geograficznych.';
COMMENT ON COLUMN SALES_LU_COUNTRY.country_code IS 'Kod kraju; ISO-like; np. PL/DE/US; PK; NL: kraj kod, country.';
COMMENT ON COLUMN SALES_LU_COUNTRY.country_name IS 'Nazwa kraju; tekst; np. Poland; atrybut; NL: kraj, państwo.';

COMMENT ON TABLE SALES_LU_ORDER_STATUS IS 'Słownik statusów zamówień; wspólny język procesu sprzedaży: NEW/PAID/CANCELLED/SHIPPED/CLOSED.';
COMMENT ON COLUMN SALES_LU_ORDER_STATUS.status_code IS 'Kod statusu zamówienia (NEW/PAID/CANCELLED/SHIPPED/CLOSED); kod; np. NEW; PK; NL: status, stan zamówienia.';
COMMENT ON COLUMN SALES_LU_ORDER_STATUS.status_desc IS 'Opis statusu; tekst; np. New; atrybut; NL: status opis, stan opis.';

COMMENT ON TABLE SALES_LU_CURRENCY IS 'Słownik walut dla zamówień; ujednolica kod waluty do rozliczeń i raportów.';
COMMENT ON COLUMN SALES_LU_CURRENCY.currency_code IS 'Kod waluty; ISO 4217; np. PLN/EUR/USD; PK; NL: waluta, currency.';
COMMENT ON COLUMN SALES_LU_CURRENCY.currency_name IS 'Nazwa waluty; tekst; np. Polish Zloty; atrybut; NL: waluta nazwa, currency name.';

COMMENT ON TABLE SALES_LU_PRODUCT_CATEGORY IS 'Słownik kategorii produktów; porządkuje ofertę do raportów produktowych.';
COMMENT ON COLUMN SALES_LU_PRODUCT_CATEGORY.category_code IS 'Kod kategorii produktu; kod; np. HW/SW/SVC/ACC; PK; NL: kategoria, typ produktu.';
COMMENT ON COLUMN SALES_LU_PRODUCT_CATEGORY.category_desc IS 'Opis kategorii; tekst; np. Hardware; atrybut; NL: kategoria opis, dział.';

COMMENT ON TABLE SALES_CUSTOMERS IS 'Klienci sprzedaży; dane identyfikacyjne i adresowe używane przy zamówieniach i analizach.';
COMMENT ON COLUMN SALES_CUSTOMERS.customer_id IS 'Id klienta; szt.; np. 1; PK; NL: id klienta, customer id.';
COMMENT ON COLUMN SALES_CUSTOMERS.customer_code IS 'Stabilny kod klienta; kod; np. CUST-ALFA; unikalne; NL: kod klienta, symbol klienta.';
COMMENT ON COLUMN SALES_CUSTOMERS.customer_name IS 'Nazwa klienta; tekst; np. Alfa Sp. z o.o.; atrybut; NL: klient, nazwa firmy.';
COMMENT ON COLUMN SALES_CUSTOMERS.segment_code IS 'Kod segmentu klienta; kod; np. SMB; FK->SALES_LU_SEGMENT; NL: segment, typ klienta.';
COMMENT ON COLUMN SALES_CUSTOMERS.city IS 'Miasto klienta; tekst; np. Warszawa; atrybut; NL: miasto, locality.';
COMMENT ON COLUMN SALES_CUSTOMERS.country_code IS 'Kod kraju klienta; kod; np. PL; FK->SALES_LU_COUNTRY; NL: kraj kod, country.';
COMMENT ON COLUMN SALES_CUSTOMERS.created_at IS 'Data utworzenia rekordu klienta; data; np. 2025-01-10; audyt; NL: data dodania, created.';
COMMENT ON COLUMN SALES_CUSTOMERS.is_active IS 'Aktywność klienta; flaga; Y/N; status; NL: aktywny, enabled.';

COMMENT ON TABLE SALES_PRODUCTS IS 'Produkty w ofercie sprzedaży; służą do pozycji zamówień i analiz per produkt/kategoria.';
COMMENT ON COLUMN SALES_PRODUCTS.product_id IS 'Id produktu; szt.; np. 1; PK; NL: id produktu, product id.';
COMMENT ON COLUMN SALES_PRODUCTS.sku IS 'SKU produktu (Stock Keeping Unit); kod; np. SKU-LAPTOP-15; unikalne; NL: sku, kod produktu.';
COMMENT ON COLUMN SALES_PRODUCTS.product_name IS 'Nazwa produktu; tekst; np. Laptop 15; atrybut; NL: produkt, nazwa pozycji.';
COMMENT ON COLUMN SALES_PRODUCTS.category_code IS 'Kod kategorii produktu; kod; np. HW; FK->SALES_LU_PRODUCT_CATEGORY; NL: kategoria, typ produktu.';
COMMENT ON COLUMN SALES_PRODUCTS.is_active IS 'Aktywność produktu; flaga; Y/N; status; NL: aktywny produkt, enabled.';

COMMENT ON TABLE SALES_ORDERS IS 'Zamówienia sprzedażowe; nagłówki zamówień z klientem, walutą i statusem procesu.';
COMMENT ON COLUMN SALES_ORDERS.order_id IS 'Id zamówienia; szt.; np. 1; PK; NL: id zamówienia, order id.';
COMMENT ON COLUMN SALES_ORDERS.order_no IS 'Numer zamówienia; kod; np. ORD-2025-0001; unikalne; NL: numer zamówienia, order number.';
COMMENT ON COLUMN SALES_ORDERS.customer_id IS 'Id klienta zamówienia; szt.; np. 1; FK->SALES_CUSTOMERS; NL: klient id, customer.';
COMMENT ON COLUMN SALES_ORDERS.created_at IS 'Data utworzenia zamówienia; data; np. 2025-02-01; audyt; NL: data zamówienia, created.';
COMMENT ON COLUMN SALES_ORDERS.closed_at IS 'Data zamknięcia zamówienia; data; NULL jeśli otwarte; np. 2025-02-10; NL: zamknięte, closed.';
COMMENT ON COLUMN SALES_ORDERS.status_code IS 'Kod statusu zamówienia (NEW/PAID/CANCELLED/SHIPPED/CLOSED); kod; np. PAID; FK->SALES_LU_ORDER_STATUS; NL: status, stan.';
COMMENT ON COLUMN SALES_ORDERS.currency_code IS 'Kod waluty zamówienia; kod; np. PLN/EUR/USD; FK->SALES_LU_CURRENCY; NL: waluta, currency.';
COMMENT ON COLUMN SALES_ORDERS.notes IS 'Notatki wewnętrzne do zamówienia; tekst; np. ustalenia; pole techniczne; NL: uwagi, notes.';

COMMENT ON TABLE SALES_ORDER_LINES IS 'Pozycje zamówień; szczegóły produktów, ilości i kwot netto/brutto do rozliczeń i raportów.';
COMMENT ON COLUMN SALES_ORDER_LINES.line_id IS 'Id pozycji zamówienia; szt.; np. 1; PK; NL: id pozycji, line id.';
COMMENT ON COLUMN SALES_ORDER_LINES.order_id IS 'Id zamówienia; szt.; np. 1; FK->SALES_ORDERS; NL: zamówienie id, order.';
COMMENT ON COLUMN SALES_ORDER_LINES.product_id IS 'Id produktu; szt.; np. 3; FK->SALES_PRODUCTS; NL: produkt id, product.';
COMMENT ON COLUMN SALES_ORDER_LINES.qty IS 'Ilość; szt.; np. 2; agregacja; NL: ilość, quantity.';
COMMENT ON COLUMN SALES_ORDER_LINES.unit_price_net IS 'Cena jednostkowa netto; waluta jak zamówienie; np. 120.00; atrybut; NL: cena netto, unit price.';
COMMENT ON COLUMN SALES_ORDER_LINES.tax_rate IS 'Stawka podatku; ułamek 0..1; np. 0.23; atrybut; NL: VAT, tax.';
COMMENT ON COLUMN SALES_ORDER_LINES.amount_net IS 'Wartość netto pozycji (qtyunit_price_net); waluta jak zamówienie; np. 240.00; agregacja; NL: kwota netto, net amount.';
COMMENT ON COLUMN SALES_ORDER_LINES.amount_gross IS 'Wartość brutto pozycji (amount_net(1+tax_rate)); waluta jak zamówienie; np. 295.20; agregacja; NL: kwota brutto, gross amount.';

INSERT INTO SALES_LU_SEGMENT (segment_code, segment_desc) VALUES ('RETAIL', 'Retail / sieci detaliczne');
INSERT INTO SALES_LU_SEGMENT (segment_code, segment_desc) VALUES ('SMB', 'Small & Medium Business');
INSERT INTO SALES_LU_SEGMENT (segment_code, segment_desc) VALUES ('ENTERPRISE', 'Enterprise / duże firmy');
INSERT INTO SALES_LU_SEGMENT (segment_code, segment_desc) VALUES ('PUBLIC', 'Public / sektor publiczny');

INSERT INTO SALES_LU_COUNTRY (country_code, country_name) VALUES ('PL', 'Poland');
INSERT INTO SALES_LU_COUNTRY (country_code, country_name) VALUES ('DE', 'Germany');
INSERT INTO SALES_LU_COUNTRY (country_code, country_name) VALUES ('US', 'United States');

INSERT INTO SALES_LU_ORDER_STATUS (status_code, status_desc) VALUES ('NEW', 'New');
INSERT INTO SALES_LU_ORDER_STATUS (status_code, status_desc) VALUES ('PAID', 'Paid');
INSERT INTO SALES_LU_ORDER_STATUS (status_code, status_desc) VALUES ('CANCELLED', 'Cancelled');
INSERT INTO SALES_LU_ORDER_STATUS (status_code, status_desc) VALUES ('SHIPPED', 'Shipped');
INSERT INTO SALES_LU_ORDER_STATUS (status_code, status_desc) VALUES ('CLOSED', 'Closed');

INSERT INTO SALES_LU_CURRENCY (currency_code, currency_name) VALUES ('PLN', 'Polish Zloty');
INSERT INTO SALES_LU_CURRENCY (currency_code, currency_name) VALUES ('EUR', 'Euro');
INSERT INTO SALES_LU_CURRENCY (currency_code, currency_name) VALUES ('USD', 'US Dollar');

INSERT INTO SALES_LU_PRODUCT_CATEGORY (category_code, category_desc) VALUES ('HW', 'Hardware');
INSERT INTO SALES_LU_PRODUCT_CATEGORY (category_code, category_desc) VALUES ('SW', 'Software');
INSERT INTO SALES_LU_PRODUCT_CATEGORY (category_code, category_desc) VALUES ('SVC', 'Services');
INSERT INTO SALES_LU_PRODUCT_CATEGORY (category_code, category_desc) VALUES ('ACC', 'Accessories');

INSERT INTO SALES_CUSTOMERS (customer_id, customer_code, customer_name, segment_code, city, country_code, created_at, is_active)
VALUES (1, 'CUST-ALFA', 'Alfa Sp. z o.o.', 'SMB', 'Warszawa', 'PL', DATE '2025-01-10', 'Y');
INSERT INTO SALES_CUSTOMERS (customer_id, customer_code, customer_name, segment_code, city, country_code, created_at, is_active)
VALUES (2, 'CUST-BETA', 'Beta Retail S.A.', 'RETAIL', 'Kraków', 'PL', DATE '2025-01-15', 'Y');
INSERT INTO SALES_CUSTOMERS (customer_id, customer_code, customer_name, segment_code, city, country_code, created_at, is_active)
VALUES (3, 'CUST-GAMMA', 'Gamma GmbH', 'ENTERPRISE', 'Berlin', 'DE', DATE '2025-01-20', 'Y');
INSERT INTO SALES_CUSTOMERS (customer_id, customer_code, customer_name, segment_code, city, country_code, created_at, is_active)
VALUES (4, 'CUST-DELTA', 'Urząd Delta', 'PUBLIC', 'Gdańsk', 'PL', DATE '2025-01-22', 'Y');
INSERT INTO SALES_CUSTOMERS (customer_id, customer_code, customer_name, segment_code, city, country_code, created_at, is_active)
VALUES (5, 'CUST-OMEGA', 'Omega Inc.', 'ENTERPRISE', 'New York', 'US', DATE '2025-01-25', 'N');

INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (1, 'SKU-KEYBOARD', 'Keyboard Pro', 'ACC', 'Y');
INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (2, 'SKU-MOUSE', 'Mouse Optic', 'ACC', 'Y');
INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (3, 'SKU-LAPTOP-15', 'Laptop 15', 'HW', 'Y');
INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (4, 'SKU-ERP-LIC', 'ERP License', 'SW', 'Y');
INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (5, 'SKU-CLOUD-SUB', 'Cloud Subscription', 'SW', 'Y');
INSERT INTO SALES_PRODUCTS (product_id, sku, product_name, category_code, is_active) VALUES (6, 'SKU-CONSULTING', 'Consulting Service', 'SVC', 'Y');

INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (1, 'ORD-2025-0001', 1, DATE '2025-02-01', NULL, 'NEW', 'PLN', 'Pierwsze zamówienie klienta');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (2, 'ORD-2025-0002', 2, DATE '2025-02-01', NULL, 'PAID', 'PLN', 'Płatność potwierdzona');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (3, 'ORD-2025-0003', 3, DATE '2025-02-02', NULL, 'SHIPPED', 'EUR', 'Wysłane kurierem');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (4, 'ORD-2025-0004', 1, DATE '2025-02-03', DATE '2025-02-03', 'CANCELLED', 'PLN', 'Anulowane przez klienta');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (5, 'ORD-2025-0005', 4, DATE '2025-02-04', NULL, 'PAID', 'EUR', 'Faktura proforma');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (6, 'ORD-2025-0006', 5, DATE '2025-02-05', DATE '2025-02-10', 'CLOSED', 'USD', 'Zamówienie zamknięte');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (7, 'ORD-2025-0007', 3, DATE '2025-03-01', DATE '2025-03-04', 'CLOSED', 'EUR', 'Kontrakt roczny');
INSERT INTO SALES_ORDERS (order_id, order_no, customer_id, created_at, closed_at, status_code, currency_code, notes)
VALUES (8, 'ORD-2025-0008', 2, DATE '2025-03-02', NULL, 'SHIPPED', 'PLN', 'Częściowa dostawa');

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (1, 1, 1, 2, 120.00, 0.23, ROUND(2120.00,2), ROUND(2120.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (2, 1, 2, 3, 60.00, 0.23, ROUND(3* 60.00,2), ROUND(3* 60.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (3, 1, 6, 5, 200.00, 0.23, ROUND(5200.00,2), ROUND(5200.00*(1+0.23),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (4, 2, 3, 1, 3500.00, 0.23, ROUND(13500.00,2), ROUND(13500.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (5, 2, 5, 2, 800.00, 0.23, ROUND(2* 800.00,2), ROUND(2* 800.00*(1+0.23),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (6, 3, 4, 1, 4800.00, 0.19, ROUND(14800.00,2), ROUND(14800.00*(1+0.19),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (7, 3, 6, 10, 180.00, 0.19, ROUND(10180.00,2), ROUND(10180.00*(1+0.19),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (8, 4, 2, 1, 60.00, 0.23, ROUND(1* 60.00,2), ROUND(1* 60.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (9, 4, 1, 1, 120.00, 0.23, ROUND(1120.00,2), ROUND(1120.00*(1+0.23),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (10, 5, 5, 3, 750.00, 0.23, ROUND(3750.00,2), ROUND(3750.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (11, 5, 6, 8, 170.00, 0.23, ROUND(8170.00,2), ROUND(8170.00*(1+0.23),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (12, 6, 3, 1, 3200.00, 0.07, ROUND(13200.00,2), ROUND(13200.00*(1+0.07),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (13, 6, 2, 2, 40.00, 0.07, ROUND(2* 40.00,2), ROUND(2* 40.00*(1+0.07),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (14, 6, 6, 6, 150.00, 0.00, ROUND(6* 150.00,2), ROUND(6* 150.00*(1+0.00),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (15, 7, 4, 2, 4500.00, 0.19, ROUND(24500.00,2), ROUND(24500.00*(1+0.19),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (16, 7, 1, 5, 90.00, 0.19, ROUND(5* 90.00,2), ROUND(5* 90.00*(1+0.19),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (17, 7, 5, 6, 700.00, 0.19, ROUND(6* 700.00,2), ROUND(6* 700.00*(1+0.19),2));

INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (18, 8, 1, 1, 120.00, 0.23, ROUND(1120.00,2), ROUND(1120.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (19, 8, 2, 2, 60.00, 0.23, ROUND(2* 60.00,2), ROUND(2* 60.00*(1+0.23),2));
INSERT INTO SALES_ORDER_LINES (line_id, order_id, product_id, qty, unit_price_net, tax_rate, amount_net, amount_gross)
VALUES (20, 8, 5, 1, 800.00, 0.23, ROUND(1800.00,2), ROUND(1800.00*(1+0.23),2));

CREATE OR REPLACE VIEW V_SALES_CUSTOMERS AS
SELECT
c.customer_id,
c.customer_code,
c.customer_name,
c.segment_code,
s.segment_desc,
c.city,
c.country_code,
co.country_name,
c.created_at,
c.is_active
FROM sales_customers c
JOIN sales_lu_segment s
ON s.segment_code = c.segment_code
JOIN sales_lu_country co
ON co.country_code = c.country_code;

CREATE OR REPLACE VIEW V_SALES_ORDERS AS
SELECT
o.order_id,
o.order_no,
o.customer_id,
c.customer_code,
c.customer_name,
o.created_at,
o.closed_at,
o.status_code,
st.status_desc,
o.currency_code,
NVL(SUM(ol.amount_net), 0) AS amount_net,
NVL(SUM(ol.amount_gross), 0) AS amount_gross,
COUNT(ol.line_id) AS lines_count
FROM sales_orders o
JOIN sales_customers c
ON c.customer_id = o.customer_id
JOIN sales_lu_order_status st
ON st.status_code = o.status_code
LEFT JOIN sales_order_lines ol
ON ol.order_id = o.order_id
GROUP BY
o.order_id,
o.order_no,
o.customer_id,
c.customer_code,
c.customer_name,
o.created_at,
o.closed_at,
o.status_code,
st.status_desc,
o.currency_code;

CREATE OR REPLACE VIEW AI_V_SALES_ORDER_LINES AS
SELECT
o.order_id,
o.order_no,
c.customer_id,
c.customer_code,
c.customer_name,
seg.segment_desc,
o.created_at,
o.closed_at,
o.status_code,
st.status_desc,
o.currency_code,
p.product_id,
p.sku,
p.product_name,
cat.category_desc,
ol.qty,
ol.amount_net,
ol.amount_gross
FROM sales_order_lines ol
JOIN sales_orders o
ON o.order_id = ol.order_id
JOIN sales_customers c
ON c.customer_id = o.customer_id
JOIN sales_lu_segment seg
ON seg.segment_code = c.segment_code
JOIN sales_lu_order_status st
ON st.status_code = o.status_code
JOIN sales_products p
ON p.product_id = ol.product_id
JOIN sales_lu_product_category cat
ON cat.category_code = p.category_code;

CREATE OR REPLACE VIEW AI_V_SALES_ORDER_DAILY AS
SELECT
TRUNC(o.created_at) AS sales_date,
o.status_code,
st.status_desc,
o.currency_code,
COUNT(DISTINCT o.order_id) AS orders_count,
NVL(SUM(ol.qty), 0) AS qty_sum,
NVL(SUM(ol.amount_net), 0) AS amount_net_sum,
NVL(SUM(ol.amount_gross), 0) AS amount_gross_sum
FROM sales_orders o
JOIN sales_lu_order_status st
ON st.status_code = o.status_code
LEFT JOIN sales_order_lines ol
ON ol.order_id = o.order_id
GROUP BY
TRUNC(o.created_at),
o.status_code,
st.status_desc,
o.currency_code;

COMMENT ON TABLE V_SALES_CUSTOMERS IS 'Widok encji klientów; łączy klienta z segmentem i krajem do spójnego użycia w aplikacji i raportach.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.customer_id IS 'Id klienta; szt.; np. 1; klucz; NL: klient id, customer.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.customer_code IS 'Kod klienta; kod; np. CUST-ALFA; unikalne; NL: kod klienta, symbol.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.customer_name IS 'Nazwa klienta; tekst; np. Alfa Sp. z o.o.; atrybut; NL: klient, firma.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.segment_code IS 'Kod segmentu; kod; np. SMB; FK; NL: segment, typ.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.segment_desc IS 'Opis segmentu; tekst; np. Small & Medium Business; atrybut; NL: segment opis.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.city IS 'Miasto; tekst; np. Warszawa; atrybut; NL: miasto.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.country_code IS 'Kod kraju; kod; np. PL; FK; NL: kraj kod.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.country_name IS 'Nazwa kraju; tekst; np. Poland; atrybut; NL: kraj.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.created_at IS 'Data utworzenia klienta; data; np. 2025-01-10; audyt; NL: created.';
COMMENT ON COLUMN V_SALES_CUSTOMERS.is_active IS 'Aktywność; flaga; Y/N; status; NL: aktywny.';

COMMENT ON TABLE V_SALES_ORDERS IS 'Widok encji zamówień; nagłówek zamówienia z klientem, statusem i sumami kwot z pozycji.';
COMMENT ON COLUMN V_SALES_ORDERS.order_id IS 'Id zamówienia; szt.; np. 1; klucz; NL: order id, zamówienie.';
COMMENT ON COLUMN V_SALES_ORDERS.order_no IS 'Numer zamówienia; kod; np. ORD-2025-0001; unikalne; NL: numer.';
COMMENT ON COLUMN V_SALES_ORDERS.customer_id IS 'Id klienta; szt.; np. 1; klucz/FK; NL: klient id.';
COMMENT ON COLUMN V_SALES_ORDERS.customer_code IS 'Kod klienta; kod; np. CUST-ALFA; atrybut; NL: kod klienta.';
COMMENT ON COLUMN V_SALES_ORDERS.customer_name IS 'Nazwa klienta; tekst; np. Alfa Sp. z o.o.; atrybut; NL: klient.';
COMMENT ON COLUMN V_SALES_ORDERS.created_at IS 'Data utworzenia zamówienia; data; np. 2025-02-01; audyt; NL: data zamówienia.';
COMMENT ON COLUMN V_SALES_ORDERS.closed_at IS 'Data zamknięcia; data; NULL jeśli otwarte; np. 2025-02-10; NL: zamknięte.';
COMMENT ON COLUMN V_SALES_ORDERS.status_code IS 'Kod statusu (NEW/PAID/CANCELLED/SHIPPED/CLOSED); kod; np. PAID; status; NL: status.';
COMMENT ON COLUMN V_SALES_ORDERS.status_desc IS 'Opis statusu; tekst; np. Paid; status; NL: status opis.';
COMMENT ON COLUMN V_SALES_ORDERS.currency_code IS 'Kod waluty; kod; np. PLN/EUR/USD; klucz raportowy; NL: waluta.';
COMMENT ON COLUMN V_SALES_ORDERS.amount_net IS 'Suma netto zamówienia; waluta jak currency_code; np. 1420.00; agregacja; NL: kwota netto.';
COMMENT ON COLUMN V_SALES_ORDERS.amount_gross IS 'Suma brutto zamówienia; waluta jak currency_code; np. 1746.60; agregacja; NL: kwota brutto.';
COMMENT ON COLUMN V_SALES_ORDERS.lines_count IS 'Liczba pozycji; szt.; np. 3; agregacja; NL: ilość pozycji, lines.';

COMMENT ON TABLE AI_V_SALES_ORDER_LINES IS 'Widok raportowy pozycji; jeden wiersz to pozycja z pełnym kontekstem zamówienia, klienta, produktu i słowników.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.order_id IS 'Id zamówienia; szt.; np. 1; klucz; NL: order id.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.order_no IS 'Numer zamówienia; kod; np. ORD-2025-0001; klucz; NL: order number.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.customer_id IS 'Id klienta; szt.; np. 1; klucz; NL: customer id.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.customer_code IS 'Kod klienta; kod; np. CUST-ALFA; atrybut; NL: kod klienta.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.customer_name IS 'Nazwa klienta; tekst; np. Alfa Sp. z o.o.; atrybut; NL: klient.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.segment_desc IS 'Segment klienta; tekst; np. SMB; atrybut; NL: segment.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.created_at IS 'Data utworzenia zamówienia; data; np. 2025-02-01; audyt; NL: created.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.closed_at IS 'Data zamknięcia; data; NULL jeśli otwarte; np. 2025-02-10; NL: closed.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.status_code IS 'Kod statusu (NEW/PAID/CANCELLED/SHIPPED/CLOSED); kod; np. SHIPPED; status; NL: status.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.status_desc IS 'Opis statusu; tekst; np. Shipped; status; NL: status opis.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.currency_code IS 'Waluta zamówienia; kod; np. PLN/EUR/USD; klucz raportowy; NL: waluta.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.product_id IS 'Id produktu; szt.; np. 3; klucz; NL: product id.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.sku IS 'SKU produktu; kod; np. SKU-LAPTOP-15; atrybut; NL: sku, kod produktu.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.product_name IS 'Nazwa produktu; tekst; np. Laptop 15; atrybut; NL: produkt.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.category_desc IS 'Kategoria produktu; tekst; np. Hardware; atrybut; NL: kategoria.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.qty IS 'Ilość; szt.; np. 2; agregacja; NL: ilość, quantity.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.amount_net IS 'Kwota netto pozycji; waluta jak currency_code; np. 240.00; agregacja; NL: kwota netto.';
COMMENT ON COLUMN AI_V_SALES_ORDER_LINES.amount_gross IS 'Kwota brutto pozycji; waluta jak currency_code; np. 295.20; agregacja; NL: kwota brutto.';

COMMENT ON TABLE AI_V_SALES_ORDER_DAILY IS 'Widok raportowy dzienny; agreguje sprzedaż per dzień, status i walutę na bazie zamówień i pozycji.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.sales_date IS 'Dzień sprzedaży (TRUNC(created_at)); data; np. 2025-02-01; klucz; NL: dzień, data sprzedaży.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.status_code IS 'Kod statusu (NEW/PAID/CANCELLED/SHIPPED/CLOSED); kod; np. PAID; klucz/status; NL: status.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.status_desc IS 'Opis statusu; tekst; np. Paid; status; NL: status opis.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.currency_code IS 'Waluta; kod; np. PLN/EUR/USD; klucz; NL: waluta.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.orders_count IS 'Liczba zamówień; szt.; np. 2; agregacja; NL: ilość zamówień.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.qty_sum IS 'Suma ilości; szt.; np. 18; agregacja; NL: suma ilości.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.amount_net_sum IS 'Suma netto; waluta jak currency_code; np. 5000.00; agregacja; NL: suma netto.';
COMMENT ON COLUMN AI_V_SALES_ORDER_DAILY.amount_gross_sum IS 'Suma brutto; waluta jak currency_code; np. 6150.00; agregacja; NL: suma brutto.';

COMMIT;
